{% extends "admin/dashboard.html" %}

{% block title %}Imágenes - Rescue{% endblock %}

{% block extra_css %}
{{ super() }}
<link href="{{ url_for('static', filename='css/modals.css') }}" rel="stylesheet">
<link href="{{ url_for('static', filename='css/hardware/hardware-main.css') }}" rel="stylesheet">
<link href="{{ url_for('static', filename='css/imagenes/imagenes-main.css') }}" rel="stylesheet">
<style>
@media (min-width: 1024px) {
  .main-content {
    margin-left: var(--sidebar-width) !important;
    width: calc(100% - var(--sidebar-width)) !important;
  }
}

@media (min-width: 1200px) {
  .main-content {
    margin-left: calc(var(--sidebar-width) + 2rem) !important;
    width: calc(100% - var(--sidebar-width) - 2rem) !important;
  }
}
</style>
{% endblock %}

{% block page_js %}
<script id="dashboardData" type="application/json">{}</script>
<script>
  window.DASHBOARD_DATA = {};
</script>
<script src="{{ url_for('static', filename='js/modal-utils.js') }}"></script>
<script src="{{ url_for('static', filename='js/imagenes/imagenes-viewer.js') }}"></script>
{% endblock %}

{% block main_content %}
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
  <div class="ios-header-container mb-8">
    <div class="ios-header-backdrop">
      <div class="ios-header-content">
        <div class="ios-header-text">
          <div class="ios-header-icon">
            <i class="fas fa-images"></i>
          </div>
          <div>
            <h1 class="ios-header-title">Biblioteca de Imágenes</h1>
            <p class="ios-header-subtitle">Lista sincronizada de carpetas desde el servicio multimedia</p>
          </div>
        </div>
        <div class="ios-header-actions">
          <span class="ios-header-pill">
            <i class="fas fa-link"></i>
            <a href="{{ images_data.service_url }}" class="hover:underline" target="_blank" rel="noopener">origen del servicio</a>
          </span>
        </div>
      </div>
    </div>
  </div>

  {% if images_data.error %}
  <div class="ios-alert ios-alert-warning mb-6">
    <i class="fas fa-triangle-exclamation"></i>
    <span>{{ images_data.error }}</span>
  </div>
  {% endif %}

  <div class="ios-filters-container ios-blur-bg mb-6">
    <div class="flex items-center justify-between flex-wrap gap-4">
      <div>
        <p class="text-sm text-white/70 dark:text-gray-300">Carpetas detectadas</p>
        <p class="text-2xl font-semibold text-white">{{ images_data.folders | length }} disponibles</p>
      </div>
      <div class="ios-header-pill">
        <i class="fas fa-rotate"></i>
        <span>Actualiza para reflejar cambios</span>
      </div>
    </div>
  </div>

  <div class="ios-hardware-grid ios-folder-grid">
    {% if images_data.folders %}
      {% for folder in images_data.folders %}
      <article class="ios-hardware-card ios-folder-card force-visible">
        <header class="ios-folder-header">
          <div class="ios-folder-avatar">{{ folder.initials }}</div>
          <div class="ios-folder-badge">
            <i class="fas fa-folder"></i>
            <span>Carpeta</span>
          </div>
        </header>
        <div class="ios-folder-body">
          <h3 class="ios-folder-title">{{ folder.display_name }}</h3>
          <p class="ios-folder-subtitle">{{ folder.name }}</p>
        </div>
        <footer class="ios-folder-footer">
          <button
            type="button"
            class="ios-action-btn ios-action-btn-secondary view-folder-btn"
            data-folder="{{ folder.name }}"
            data-folder-display="{{ folder.display_name }}"
            data-fetch-url="{{ url_for('admin_imagenes_folder_files', folder_name=folder.name) }}"
          >
            <i class="fas fa-eye"></i>
            <span>Ver archivos</span>
          </button>
        </footer>
      </article>
      {% endfor %}
    {% else %}
      <div class="col-span-full">
        <div class="ios-empty-state">
          <div class="ios-empty-icon"><i class="fas fa-folder-open"></i></div>
          <h3 class="ios-empty-title">Sin carpetas disponibles</h3>
          <p class="ios-empty-subtitle">Confirma que el servicio esté en línea y vuelve a intentarlo.</p>
        </div>
      </div>
    {% endif %}
  </div>
</div>

<div id="viewFolderModal" class="ios-modal-backdrop hidden">
  <div class="ios-blur-modal-container w-full max-w-3xl">
    <div class="ios-blur-header">
      <div class="flex items-center justify-between w-full">
        <div class="flex items-center gap-3">
          <div class="w-12 h-12 bg-gradient-to-br from-sky-500 to-indigo-500 rounded-xl flex items-center justify-center shadow-lg">
            <i class="fas fa-eye text-white text-xl"></i>
          </div>
          <div>
            <h3 class="text-2xl font-bold text-white" id="viewFolderModalTitle">Carpeta seleccionada</h3>
            <p class="text-sm text-white/70">Archivos disponibles en la carpeta sincronizada</p>
          </div>
        </div>
        <button type="button" class="ios-blur-btn ios-blur-btn-secondary !p-2 !min-w-0" data-modal-close aria-label="Cerrar modal">
          <i class="fas fa-times text-lg"></i>
        </button>
      </div>
    </div>
    <div class="ios-blur-body space-y-6">
      <div id="folderFilesStatus" class="ios-folder-status hidden" aria-live="polite">
        <i id="folderFilesStatusIcon" class="fas fa-circle-info"></i>
        <span id="folderFilesStatusText"></span>
      </div>
      <p class="text-sm text-white/60 hidden" id="viewFolderModalCounter"></p>
      <div id="folderFilesGrid" class="ios-folder-files-grid"></div>
    </div>
    <div class="ios-blur-footer">
      <button type="button" class="ios-blur-btn ios-blur-btn-secondary" data-modal-close>
        <i class="fas fa-times mr-2"></i>
        Cerrar
      </button>
    </div>
  </div>
</div>
{% endblock %}
