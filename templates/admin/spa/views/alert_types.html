<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
  <div class="ios-header-container mb-8">
    <div class="ios-header-backdrop">
      <div class="ios-header-content">
        <div class="ios-header-text">
          <div class="ios-header-icon">
            <i class="fas fa-bell"></i>
          </div>
          <div>
            <h1 class="ios-header-title">Catalogo de Tipos de Alertas</h1>
            <p class="ios-header-subtitle">Configura prioridades, acciones y cobertura para cada tipo</p>
          </div>
        </div>
        <div class="ios-header-actions">
          <button class="ios-action-btn ios-action-btn-primary" type="button" onclick="openCreateAlertTypeModal()">
            <i class="fas fa-plus"></i>
            <span>Nuevo Tipo</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <div class="ios-stats-grid alert-types-stats-grid">
    <div class="ios-stat-card" data-stat="total">
      <div class="ios-stat-icon ios-stat-icon-blue">
        <i class="fas fa-list"></i>
      </div>
      <div class="ios-stat-content">
        <div class="ios-stat-label">Tipos Registrados</div>
        <div class="ios-stat-value" id="alertTypesTotalCount">0</div>
        <div class="ios-stat-trend">Catalogo global</div>
      </div>
      <div class="ios-stat-shimmer"></div>
    </div>

    <div class="ios-stat-card" data-stat="active">
      <div class="ios-stat-icon ios-stat-icon-green">
        <i class="fas fa-check-circle"></i>
      </div>
      <div class="ios-stat-content">
        <div class="ios-stat-label">Activos</div>
        <div class="ios-stat-value" id="alertTypesActiveCount">0</div>
        <div class="ios-stat-trend">Operativos</div>
      </div>
      <div class="ios-stat-shimmer"></div>
    </div>

    <div class="ios-stat-card" data-stat="critical">
      <div class="ios-stat-icon ios-stat-icon-red">
        <i class="fas fa-exclamation-triangle"></i>
      </div>
      <div class="ios-stat-content">
        <div class="ios-stat-label">Prioridad Maxima</div>
        <div class="ios-stat-value" id="alertTypesCriticalCount">0</div>
        <div class="ios-stat-trend">Alto impacto</div>
      </div>
      <div class="ios-stat-shimmer"></div>
    </div>
  </div>

  <div class="ios-filters-container ios-blur-bg mb-8" id="alertTypesFilters">
    <div class="ios-filters-grid">
      <div class="ios-filter-item">
        <label class="ios-filter-label" for="alertTypesStatusFilter">Estado</label>
        <select id="alertTypesStatusFilter" class="ios-filter-input">
          <option value="active">Mostrar activos</option>
          <option value="inactive">Mostrar inactivos</option>
          <option value="all">Mostrar todos</option>
        </select>
      </div>
    </div>
  </div>

  <section id="alertTypesGrid" class="ios-hardware-grid mt-10" aria-label="Listado de tipos de alertas">
    <div id="alertTypesEmpty" class="alert-types-empty hidden">
      <div class="alert-types-empty__icon">
        <i class="fas fa-bell-slash"></i>
      </div>
      <h3>No hay tipos configurados</h3>
      <p>Agrega un tipo de alerta para definir prioridades, equipos y canales de notificacion.</p>
    </div>
  </section>
</div>

<!-- Modal: Desactivar Tipo de Alerta -->
<div id="toggleAlertTypeModal" class="ios-modal-backdrop toggle-modal hidden" role="dialog" aria-modal="true" aria-labelledby="toggleAlertTypeTitle">
  <div class="ios-blur-modal-container max-w-md" id="toggleAlertTypeContainer">
    <div class="ios-blur-header text-center">
      <div class="toggle-modal-icon deactivate mx-auto mb-4" id="toggleAlertTypeIcon">
        <i class="fas fa-power-off text-4xl" id="toggleAlertTypeIconFa"></i>
      </div>
      <h2 id="toggleAlertTypeTitle" class="text-2xl font-semibold text-white">Desactivar tipo de alerta</h2>
    </div>

    <div class="ios-blur-body space-y-6">
      <p class="text-white/80 text-lg text-center" id="toggleAlertTypeMessage">Estas seguro de que quieres desactivar este tipo de alerta?</p>

      <div id="alertTypeDeactivateFeedback" class="hidden px-4 py-3 rounded-lg border border-red-400 bg-red-500/20 text-red-100 text-sm"></div>
    </div>

    <div class="ios-blur-footer">
      <button type="button" class="ios-blur-btn ios-blur-btn-secondary" onclick="closeDeactivateAlertTypeModal()">
        <i class="fas fa-times mr-2"></i>
        Cancelar
      </button>
      <button type="button" class="ios-blur-btn ios-blur-btn-primary" id="alertTypeDeactivateConfirmBtn" onclick="confirmToggleAlertType()">
        <i class="fas fa-power-off mr-2" id="alertTypeDeactivateConfirmIcon"></i>
        <span id="alertTypeDeactivateConfirmText">Desactivar</span>
      </button>
    </div>
  </div>
</div>

<!-- Modal: Detalles Tipo de Alerta -->
<div id="viewAlertTypeModal" class="ios-modal-backdrop hidden" role="dialog" aria-modal="true" aria-labelledby="viewAlertTypeTitle">
  <div class="ios-blur-modal-container max-w-3xl">
    <div class="ios-blur-header">
      <div class="flex items-center justify-between w-full">
        <div class="flex items-center space-x-3">
          <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-red-500 via-orange-500 to-yellow-400 flex items-center justify-center shadow-lg">
            <i class="fas fa-bell text-white text-xl"></i>
          </div>
          <div>
            <h2 id="viewAlertTypeTitle" class="text-2xl font-semibold text-white">Detalle del tipo de alerta</h2>
            <p class="text-sm text-white/70" id="viewAlertTypeSubtitle">Consulta la configuracion completa</p>
          </div>
        </div>
        <button type="button" class="ios-blur-btn ios-blur-btn-secondary !p-2" onclick="closeViewAlertTypeModal()" aria-label="Cerrar modal">
          <i class="fas fa-times text-lg"></i>
        </button>
      </div>
    </div>

    <div class="ios-blur-body space-y-6" id="viewAlertTypeBody">
      <div class="alert-type-detail-header">
        <div>
          <h3 class="alert-type-detail-title" id="alertDetailName">-</h3>
          <p class="alert-type-detail-description" id="alertDetailDescription">-</p>
        </div>
        <div class="alert-type-detail-meta">
          <span class="ios-status-badge" id="alertDetailSeverity">-</span>
          <span class="alert-type-detail-color" id="alertDetailColorSwatch">-</span>
        </div>
      </div>

      <div class="alert-type-detail-grid">
        <dl>
          <div>
            <dt>Estado</dt>
            <dd id="alertDetailActive">-</dd>
          </div>
          <div>
            <dt>Color configurado</dt>
            <dd id="alertDetailColorValue">-</dd>
          </div>
          <div>
            <dt>Empresa asociada</dt>
            <dd id="alertDetailCompany">Global</dd>
          </div>
          <div>
            <dt>Creacion</dt>
            <dd id="alertDetailCreated">-</dd>
          </div>
          <div>
            <dt>Ultima actualizacion</dt>
            <dd id="alertDetailUpdated">-</dd>
          </div>
        </dl>

        <div class="alert-type-detail-media" id="alertDetailMediaContainer" hidden>
          <div class="alert-type-detail-media-preview" id="alertDetailImagePreview"></div>
          <div class="alert-type-detail-media-audio" id="alertDetailAudioContainer"></div>
        </div>
      </div>

      <div class="alert-type-detail-lists">
        <div>
          <h4><i class="fas fa-clipboard-list"></i> Recomendaciones</h4>
          <ul id="alertDetailRecommendations" class="alert-type-detail-list"></ul>
        </div>
        <div>
          <h4><i class="fas fa-toolbox"></i> Implementos necesarios</h4>
          <ul id="alertDetailEquipment" class="alert-type-detail-list"></ul>
        </div>
      </div>

      <div id="alertDetailFeedback" class="hidden px-4 py-3 rounded-lg border border-red-400 bg-red-500/20 text-red-100 text-sm"></div>
    </div>

    <div class="ios-blur-footer">
      <button type="button" class="ios-blur-btn ios-blur-btn-secondary" onclick="closeViewAlertTypeModal()">
        <i class="fas fa-times mr-2"></i>
        Cerrar
      </button>
    </div>
  </div>
</div>

<!-- Modal: Crear Tipo de Alerta -->
<div id="createAlertTypeModal" class="ios-modal-backdrop hidden" role="dialog" aria-modal="true" aria-labelledby="createAlertTypeTitle">
  <div class="ios-blur-modal-container flex flex-col w-full max-w-3xl sm:max-w-4xl lg:max-w-5xl xl:max-w-6xl !max-h-[92vh] sm:!max-h-[90vh] overflow-hidden">
    <div class="ios-blur-header">
      <div class="flex flex-col items-start gap-4 w-full sm:flex-row sm:items-center sm:justify-between">
        <div class="flex items-center gap-3 flex-1 min-w-0">
          <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-red-500 via-orange-500 to-yellow-400 flex items-center justify-center shadow-lg">
            <i class="fas fa-bell text-gray-900 dark:text-white text-xl"></i>
          </div>
          <div class="min-w-0">
            <h2 id="createAlertTypeTitle" class="text-2xl font-bold text-gray-900 dark:text-white">Nuevo tipo de alerta</h2>
            <p class="text-sm text-gray-600 dark:text-gray-300" id="createAlertTypeSubtitle">Define los atributos basicos y las recomendaciones iniciales</p>
          </div>
        </div>
        <button type="button" class="ios-blur-btn ios-blur-btn-secondary shrink-0 !p-2 !min-w-0" data-modal-close aria-label="Cerrar modal" onclick="closeCreateAlertTypeModal()">
          <i class="fas fa-times text-lg"></i>
        </button>
      </div>
    </div>

    <div class="ios-blur-body flex-1 min-h-0 !max-h-none">
      <form id="createAlertTypeForm" class="space-y-6">
        <div id="alertTypeFormFeedback" class="hidden px-4 py-3 rounded-lg border border-red-400 bg-red-500/20 text-red-100 text-sm"></div>

        <div class="form-grid">
          <div class="form-group">
            <label for="alertTypeName" class="block text-sm font-semibold text-gray-700 dark:text-gray-200 mb-2">Nombre *</label>
            <input type="text" id="alertTypeName" name="nombre" class="ios-blur-input" placeholder="Ej. Evacuacion Total" maxlength="24" required>
            <p class="text-xs text-gray-500 dark:text-gray-400 mt-1" id="alertTypeNameHelper">Maximo 24 caracteres. <span id="alertTypeNameCounter">0/24</span></p>
          </div>

          <div class="form-group">
            <label for="alertTypeSeverity" class="block text-sm font-semibold text-gray-700 dark:text-gray-200 mb-2">Nivel de alerta *</label>
            <select id="alertTypeSeverity" name="tipo_alerta" class="ios-blur-input" required>
              <option value="">Selecciona un nivel</option>
              <option value="ROJO">Rojo (Critica)</option>
              <option value="NARANJA">Naranja (Alta)</option>
              <option value="AMARILLO">Amarillo (Media)</option>
              <option value="VERDE">Verde (Baja)</option>
            </select>
          </div>

          <div class="form-group">
            <label for="alertTypeColor" class="block text-sm font-semibold text-gray-700 dark:text-gray-200 mb-2">Color *</label>
            <input type="text" id="alertTypeColor" name="color_alerta" class="ios-blur-input" placeholder="Ej. Rojo intenso" required>
            <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Ingresa el color como texto descriptivo (ej.: "Rojo", "Verde").</p>
          </div>

          <div class="form-group">
            <label class="block text-sm font-semibold text-gray-700 dark:text-gray-200 mb-2" for="alertTypeScopeGlobal">Ambito</label>
            <div class="flex items-center space-x-3 text-gray-600 dark:text-gray-300" id="alertTypeScopeWrapper">
              <input type="checkbox" id="alertTypeScopeGlobal" class="h-4 w-4 text-sky-400 border-slate-400 rounded focus:ring-sky-400">
              <label for="alertTypeScopeGlobal" class="text-sm" id="alertTypeScopeLabel">Convertir en alerta global</label>
            </div>
            <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Marca esta opcion para aplicar la alerta a todas las empresas del ecosistema.</p>
          </div>

          <div class="form-group" id="alertTypeCompanyGroup">
            <label for="alertTypeCompanySelect" class="block text-sm font-semibold text-gray-700 dark:text-gray-200 mb-2">Empresa</label>
            <select id="alertTypeCompanySelect" name="empresa_id" class="ios-blur-input">
              <option value="">Selecciona una empresa</option>
            </select>
            <p class="text-xs text-gray-500 dark:text-gray-400 mt-1" id="alertTypeCompanyHelper">Selecciona la empresa para asociar la alerta.</p>
          </div>
        </div>

        <div class="form-group">
          <label for="alertTypeDescription" class="block text-sm font-semibold text-gray-700 dark:text-gray-200 mb-2">Descripcion *</label>
          <textarea id="alertTypeDescription" name="descripcion" class="ios-blur-input" rows="3" placeholder="Describe cuando se activa esta alerta" maxlength="65" required></textarea>
          <p class="text-xs text-gray-500 dark:text-gray-400 mt-1" id="alertTypeDescriptionHelper">Maximo 65 caracteres. <span id="alertTypeDescriptionCounter">0/65</span></p>
        </div>

        <div class="form-grid">
          <div class="form-group">
            <label class="block text-sm font-semibold text-gray-700 dark:text-gray-200 mb-2">Imagen de referencia</label>
            <div class="ios-file-picker">
              <div class="ios-file-picker-row">
                <select id="alertImageFolderSelect" class="ios-blur-input">
                  <option value="">Selecciona una carpeta</option>
                </select>
                <select id="alertImageFileSelect" class="ios-blur-input" disabled>
                  <option value="">Selecciona un archivo</option>
                </select>
              </div>
              <p class="ios-file-helper">Elige un archivo del gestor de imagenes. Las miniaturas se generan automaticamente.</p>
              <div id="alertImagePreview" class="ios-file-preview ios-file-preview--image">
                <div class="ios-file-preview__placeholder">
                  <i class="fas fa-image"></i>
                  <span>No se ha seleccionado imagen</span>
                </div>
              </div>
            </div>
            <input type="hidden" name="imagen_base64" id="alertTypeImage">
            <input type="hidden" name="imagen_url" id="alertTypeImageUrl">
            <input type="hidden" name="imagen_nombre" id="alertTypeImageName">
          </div>

          <div class="form-group">
            <label class="block text-sm font-semibold text-gray-700 dark:text-gray-200 mb-2">Sonido asignado</label>
            <div class="ios-file-picker">
              <div class="ios-file-picker-row">
                <select id="alertSoundFolderSelect" class="ios-blur-input">
                  <option value="">Selecciona una carpeta</option>
                </select>
                <select id="alertSoundFileSelect" class="ios-blur-input" disabled>
                  <option value="">Selecciona un archivo</option>
                </select>
              </div>
              <p class="ios-file-helper">Selecciona archivos de audio en formato MP3, WAV u OGG.</p>
              <div id="alertSoundPreview" class="ios-file-preview ios-file-preview--audio">
                <div class="ios-file-preview__placeholder">
                  <i class="fas fa-volume-up"></i>
                  <span>No se ha seleccionado sonido</span>
                </div>
              </div>
            </div>
            <input type="hidden" name="sonido_link" id="alertTypeSound">
          </div>
        </div>

        <div class="form-grid">
          <div class="form-group">
            <label for="alertRecommendationInput" class="block text-sm font-semibold text-gray-700 dark:text-gray-200 mb-2">Recomendaciones iniciales</label>
            <div class="ios-chip-input">
              <input type="text" id="alertRecommendationInput" class="ios-blur-input" placeholder="Ej. Detener actividades y desalojar">
              <button type="button" class="ios-blur-btn ios-blur-btn-primary !p-2 !min-w-0" id="alertRecommendationAddBtn">
                <i class="fas fa-plus"></i>
                <span class="text-sm font-medium">Agregar</span>
              </button>
            </div>
            <p class="ios-chip-helper">Presiona Enter o haz clic en "Agregar" para registrar cada recomendacion.</p>
            <div id="alertRecommendationsList" class="ios-chip-container"></div>
          </div>

          <div class="form-group">
            <label for="alertEquipmentInput" class="block text-sm font-semibold text-gray-700 dark:text-gray-200 mb-2">Implementos necesarios</label>
            <div class="ios-chip-input">
              <input type="text" id="alertEquipmentInput" class="ios-blur-input" placeholder="Ej. Kit de primeros auxilios">
              <button type="button" class="ios-blur-btn ios-blur-btn-primary !p-2 !min-w-0" id="alertEquipmentAddBtn">
                <i class="fas fa-plus"></i>
                <span class="text-sm font-medium">Agregar</span>
              </button>
            </div>
            <p class="ios-chip-helper">Registra cada implemento por separado. Puedes dejar la seccion vacia.</p>
            <div id="alertEquipmentList" class="ios-chip-container"></div>
          </div>
        </div>
      </form>
    </div>

    <div class="ios-blur-footer flex flex-col sm:flex-row gap-3 sm:justify-end">
      <button type="button" class="ios-blur-btn ios-blur-btn-secondary" onclick="closeCreateAlertTypeModal()">
        <i class="fas fa-times mr-2"></i>
        <span class="text-sm font-medium">Cancelar</span>
      </button>
      <button type="submit" form="createAlertTypeForm" class="ios-blur-btn ios-blur-btn-primary" id="createAlertTypeSubmit">
        <i class="fas fa-save mr-2"></i>
        <span class="text-sm font-medium">Guardar tipo de alerta</span>
      </button>
    </div>
  </div>
</div>
