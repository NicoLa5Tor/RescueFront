{% extends "base.html" %}
{% block title %}Empresa - Rescue{% endblock %}

{% block extra_css %}
<!-- External Libraries -->
    <link href="{{ url_for('static', filename='css/output.css') }}" rel="stylesheet">

<!-- Dashboard CSS bÃ¡sico -->
<link href="{{ url_for('static', filename='css/spa/variables.css') }}" rel="stylesheet">

<!-- Hardware iOS Design System (CSS principal que incluye todo) -->
<link href="{{ url_for('static', filename='css/spa/spa-global.css') }}" rel="stylesheet">

<!-- Global Text Theme CSS -->
<link href="{{ url_for('static', filename='css/global-text-theme.css') }}" rel="stylesheet">
<link href="{{ url_for('static', filename='css/portal-empresa/spa/shell-spa.css') }}" rel="stylesheet">
<link href="{{ url_for('static', filename='css/portal-empresa/spa/navbar-spa.css') }}" rel="stylesheet">
<link href="{{ url_for('static', filename='css/portal-empresa/spa/sidebar-spa.css') }}" rel="stylesheet">
<link href="{{ url_for('static', filename='css/portal-empresa/spa/views/dashboard.css') }}" rel="stylesheet">
<link href="{{ url_for('static', filename='css/portal-empresa/spa/views/hardware.css') }}" rel="stylesheet">
<link href="{{ url_for('static', filename='css/alerts/alerts-styles.css') }}" rel="stylesheet">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/intl-tel-input@18.2.1/build/css/intlTelInput.css">

<!-- CSS personalizado comentado - Usando solo CSS de hardware -->
<style>
/* Corregir modales para que no se vean afectados por el margin del sidebar */
.ios-modal-backdrop,
.modal-backdrop {
  margin-left: 0 !important;
  width: 100vw !important;
  position: fixed !important;
  left: 0 !important;
  right: 0 !important;
}

.ios-blur-modal-container {
  position: relative !important;
}

/* Asegurar que el contenido del modal no se vea afectado */
.ios-blur-body {
  margin-left: 0 !important;
  width: 100% !important;
  box-sizing: border-box !important;
}

/* Resto de estilos comentados - usando CSS de hardware */
/*
.stat-updated {
  animation: statHighlight 1s ease-in-out;
}

@keyframes statHighlight {
  0% { 
    background-color: rgba(59, 130, 246, 0.1);
    transform: scale(1);
  }
  50% { 
    background-color: rgba(59, 130, 246, 0.2);
    transform: scale(1.05);
  }
  100% { 
    background-color: transparent;
    transform: scale(1);
  }
}

.skeleton-item {
  animation: skeleton-loading 1.5s ease-in-out infinite alternate;
}

@keyframes skeleton-loading {
  0% { opacity: 0.6; }
  100% { opacity: 1; }
}

.toast-notification {
  transition: all 0.3s ease-in-out;
}

.toast-notification.toast-enter {
  opacity: 0;
  transform: translateX(100%);
}

.toast-notification.toast-exit {
  opacity: 0;
  transform: translateX(100%);
}

.chart-loading-overlay {
  background: rgba(255, 255, 255, 0.8);
}

.dark .chart-loading-overlay {
  background: rgba(31, 41, 55, 0.8);
}

.refresh-button:hover {
  transform: rotate(180deg);
  transition: transform 0.3s ease;
}

.chart-header {
  display: flex;
  flex-direction: column;
  align-items: center;
  text-align: center;
  padding: var(--space-6) var(--space-6) var(--space-4);
}

.chart-header h3 {
  margin: 0;
  font-size: var(--text-xl);
  font-weight: var(--font-bold);
  color: var(--text-primary) !important;
  line-height: var(--leading-tight);
}

.chart-header p {
  margin: var(--space-1) 0 0 0;
  font-size: var(--text-sm);
  color: var(--text-secondary) !important;
  line-height: var(--leading-tight);
}
*/
</style>
{% endblock %}

{% block navbar %}{% endblock %}

{% block content %}
<!-- Animated Background -->
<div class="animated-bg"></div>
{% from "empresa/spa/shell.html" import spa_shell %}
{% call spa_shell(active_page=active_page) %}
  {% block main_content %}
  {% from "empresa/spa/container.html" import spa_container %}
  {% call spa_container(default_view=default_view or 'dashboard') %}
  <section class="spa-view" data-spa-section="dashboard">
    {% include "empresa/spa/views/dashboard.html" %}
  </section>
  <section class="spa-view is-hidden" data-spa-section="usuarios">
    {% include "empresa/spa/views/usuarios.html" %}
  </section>
  <section class="spa-view is-hidden" data-spa-section="hardware">
    {% include "empresa/spa/views/hardware.html" %}
  </section>
  <section class="spa-view is-hidden" data-spa-section="stats">
    {% include "empresa/spa/views/stats.html" %}
  </section>
  <section class="spa-view is-hidden" data-spa-section="alertas">
    {% include "empresa/spa/views/alertas.html" %}
  </section>
  <section class="spa-view is-hidden" data-spa-section="alertas-inactivas">
    {% include "empresa/spa/views/alertas_inactivas.html" %}
  </section>
  {% endcall %}
  {% endblock %}
{% endcall %}
{% include "empresa/spa/views/alertas_detail_modal.html" %}
{% endblock %}

{% block extra_js %}
<script>
  window.currentUser = {{ session.get('user') | tojson }};
  if (window.currentUser && !window.userRole) {
    window.userRole = window.currentUser.role;
  }
  if (window.currentUser && window.currentUser.role === 'empresa') {
    window.empresaId = window.currentUser.id || window.currentUser.empresa_id || '';
    window.empresaNombre = window.currentUser.username || window.currentUser.nombre || 'Mi Empresa';
  }
  window.EMPRESA_SPA_MANUAL_INIT = true;
  window.EMPRESA_ID = window.empresaId || {{ (empresa_id or '') | tojson }};
  window.EMPRESA_USERNAME = window.empresaNombre || {{ (empresa_username or '') | tojson }};
</script>
<!-- SPA Shell Scripts -->
<script src="{{ url_for('static', filename='js/portal-empresa/spa/shell.js') }}"></script>
<script src="{{ url_for('static', filename='js/portal-empresa/spa/theme-toggle.js') }}"></script>
<script src="{{ url_for('static', filename='js/portal-empresa/alerts-global.js') }}"></script>
<script src="{{ url_for('static', filename='js/hardware/location-modal-animations.js') }}"></script>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
<script src="{{ url_for('static', filename='js/api-client.js') }}"></script>
<script src="{{ url_for('static', filename='js/portal-empresa/spa/store.js') }}"></script>
<script src="{{ url_for('static', filename='js/portal-empresa/spa/api.js') }}"></script>
<script src="{{ url_for('static', filename='js/modal-utils.js') }}"></script>
<script src="{{ url_for('static', filename='js/hardware/hardware-validation.js') }}"></script>
<script src="{{ url_for('static', filename='js/hardware/hardware-core.js') }}"></script>
<script src="{{ url_for('static', filename='js/hardware/hardware-main.js') }}"></script>
<script src="{{ url_for('static', filename='js/portal-empresa/hardware-status-live.js') }}"></script>
<script src="{{ url_for('static', filename='js/portal-empresa/spa/views/hardware-page.js') }}"></script>
<script>
  window.EMPRESA_SPA_MODE = true;
</script>

{% block page_js %}{% endblock %}
<script src="{{ url_for('static', filename='js/portal-empresa/spa/views/dashboard.js') }}"></script>
<script src="{{ url_for('static', filename='js/portal-empresa/spa/views/stats.js') }}"></script>
<script src="https://cdn.jsdelivr.net/npm/intl-tel-input@18.2.1/build/js/intlTelInput.min.js"></script>
<script src="{{ url_for('static', filename='js/portal-empresa/spa/views/usuarios-data.js') }}"></script>
<script src="{{ url_for('static', filename='js/portal-empresa/spa/views/usuarios-main.js') }}"></script>
<script src="{{ url_for('static', filename='js/portal-empresa/spa/views/usuarios-modals.js') }}"></script>
<script src="{{ url_for('static', filename='js/portal-empresa/spa/views/usuarios-view.js') }}"></script>
<script src="{{ url_for('static', filename='js/portal-empresa/spa/views/alertas.js') }}"></script>
<script src="{{ url_for('static', filename='js/portal-empresa/spa/views/alertas-create.js') }}"></script>
<script src="{{ url_for('static', filename='js/portal-empresa/spa/views/alertas-inactivas.js') }}"></script>
<script src="{{ url_for('static', filename='js/portal-empresa/spa/router.js') }}"></script>
<script>
  if (typeof EndpointTestClient !== 'undefined' && !window.apiClient) {
    window.apiClient = new EndpointTestClient();
  }
</script>

{% endblock %}
{% block footer %}{% endblock %}
