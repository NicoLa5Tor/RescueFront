{% extends "empresa/dashboard.html" %}

{% block title %}Dashboard Principal - {{ empresa_username }}{% endblock %}

{% block extra_css %}
{{ super() }}
<!-- Usar los estilos iOS que ya sabemos -->
<link href="{{ url_for('static', filename='css/hardware/hardware-main.css') }}" rel="stylesheet">
<style>
/* Asegurar visibilidad por defecto */
.ios-stats-grid .ios-stat-card,
.dashboard-main-container .ios-stat-card,
.quick-access-card {
  opacity: 1 !important;
  transform: none !important;
  visibility: visible !important;
}

/* Estilos para KPIs principales */
.kpi-card {
  background: rgba(255, 255, 255, 0.1);
  backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 16px;
  padding: 1.5rem;
  transition: all 0.3s ease;
}

.kpi-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
}

/* Quick access cards */
.quick-access-card {
  background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
  backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 16px;
  padding: 2rem;
  text-align: center;
  transition: all 0.3s ease;
  cursor: pointer;
  text-decoration: none;
  color: inherit;
}

.quick-access-card:hover {
  transform: translateY(-4px);
  box-shadow: 0 12px 35px rgba(0, 0, 0, 0.15);
  border-color: rgba(255, 255, 255, 0.3);
  text-decoration: none;
  color: inherit;
}

.quick-access-icon {
  width: 80px;
  height: 80px;
  margin: 0 auto 1rem;
  background: linear-gradient(135deg, #3b82f6, #1d4ed8);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 2rem;
  color: white;
}

.quick-access-title {
  font-size: 1.25rem;
  font-weight: 600;
  color: white;
  margin-bottom: 0.5rem;
}

.quick-access-description {
  font-size: 0.875rem;
  color: rgba(255, 255, 255, 0.7);
  line-height: 1.4;
}

/* Empresa info section */
.empresa-info-card {
  background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(29, 78, 216, 0.1));
  backdrop-filter: blur(20px);
  border: 1px solid rgba(59, 130, 246, 0.3);
  border-radius: 20px;
  padding: 2rem;
}

/* Welcome section */
.welcome-section {
  text-align: center;
  margin-bottom: 3rem;
}

.welcome-title {
  font-size: 3rem;
  font-weight: 800;
  background: linear-gradient(135deg, #3b82f6, #1d4ed8);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  margin-bottom: 0.5rem;
}

.welcome-subtitle {
  font-size: 1.25rem;
  color: rgba(255, 255, 255, 0.8);
  margin-bottom: 1rem;
}
</style>
{% endblock %}

{% block main_content %}
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 dashboard-main-container">
  
  <!-- Welcome Section -->
  <div class="welcome-section">
    <h1 class="welcome-title">¬°Bienvenido!</h1>
    <p class="welcome-subtitle">Panel de Control Empresarial</p>
    <div class="text-sm text-white/60">
      {{ dashboard_summary.empresa.nombre }}
    </div>
  </div>

  <!-- Empresa Info Card -->
  <div class="empresa-info-card mb-8">
    <div class="flex items-center justify-between">
      <div class="flex items-center space-x-4">
        <div class="w-20 h-20 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-xl flex items-center justify-center">
          <span class="text-white font-bold text-3xl">{{ dashboard_summary.empresa.nombre[:2].upper() }}</span>
        </div>
        <div>
          <h2 class="text-2xl font-bold text-white">{{ dashboard_summary.empresa.nombre }}</h2>
          <p class="text-blue-200">Dashboard Empresarial</p>
        </div>
      </div>
      <div class="text-right">
        <div class="px-4 py-2 bg-green-500 text-white text-sm font-medium rounded-full">
          {% if dashboard_summary.empresa.activa %}ACTIVA{% else %}INACTIVA{% endif %}
        </div>
      </div>
    </div>
  </div>

  <!-- KPIs Principales -->
  <div class="mb-8">
    <h3 class="text-xl font-bold text-white mb-4">
      <i class="fas fa-tachometer-alt mr-2 text-blue-400"></i>
      KPIs Principales
    </h3>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
      
      <!-- Total Usuarios -->
      <div class="kpi-card">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-white/80 text-sm font-medium">Total Usuarios</p>
            <p class="text-3xl font-bold text-white">{{ dashboard_summary.kpis.usuarios_total }}</p>
            <p class="text-green-400 text-xs">{{ dashboard_summary.kpis.usuarios_activos }} activos</p>
          </div>
          <div class="w-12 h-12 bg-blue-500 rounded-lg flex items-center justify-center">
            <i class="fas fa-users text-white text-xl"></i>
          </div>
        </div>
      </div>

      <!-- Hardware Total -->
      <div class="kpi-card">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-white/80 text-sm font-medium">Hardware Total</p>
            <p class="text-3xl font-bold text-white">{{ dashboard_summary.kpis.hardware_total }}</p>
            <p class="text-blue-400 text-xs">dispositivos</p>
          </div>
          <div class="w-12 h-12 bg-green-500 rounded-lg flex items-center justify-center">
            <i class="fas fa-microchip text-white text-xl"></i>
          </div>
        </div>
      </div>

      <!-- Alertas Activas -->
      <div class="kpi-card">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-white/80 text-sm font-medium">Alertas Activas</p>
            <p class="text-3xl font-bold text-white">{{ dashboard_summary.kpis.alertas_activas }}</p>
            <p class="text-yellow-400 text-xs">pendientes</p>
          </div>
          <div class="w-12 h-12 bg-yellow-500 rounded-lg flex items-center justify-center">
            <i class="fas fa-exclamation-triangle text-white text-xl"></i>
          </div>
        </div>
      </div>

      <!-- Estado General -->
      <div class="kpi-card">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-white/80 text-sm font-medium">Estado General</p>
            <p class="text-3xl font-bold text-green-400">OK</p>
            <p class="text-white/60 text-xs">sistema operativo</p>
          </div>
          <div class="w-12 h-12 bg-purple-500 rounded-lg flex items-center justify-center">
            <i class="fas fa-check-circle text-white text-xl"></i>
          </div>
        </div>
      </div>

    </div>
  </div>

  <!-- Acceso R√°pido -->
  <div class="mb-8">
    <h3 class="text-xl font-bold text-white mb-4">
      <i class="fas fa-rocket mr-2 text-purple-400"></i>
      Acceso R√°pido
    </h3>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      
      {% for item in dashboard_summary.quick_access %}
      <a href="{{ url_for(item.url) }}" class="quick-access-card">
        <div class="quick-access-icon">
          <i class="{{ item.icon }}"></i>
        </div>
        <h4 class="quick-access-title">{{ item.name }}</h4>
        <p class="quick-access-description">{{ item.description }}</p>
      </a>
      {% endfor %}

      <!-- Estad√≠sticas del Sistema (adicional) -->
      <div class="quick-access-card" onclick="showSystemInfo()">
        <div class="quick-access-icon" style="background: linear-gradient(135deg, #10b981, #047857);">
          <i class="fas fa-info-circle"></i>
        </div>
        <h4 class="quick-access-title">Informaci√≥n del Sistema</h4>
        <p class="quick-access-description">Ver detalles t√©cnicos y estado del sistema</p>
      </div>

    </div>
  </div>

  <!-- Informaci√≥n adicional -->
  <div class="text-center mt-8">
    <div class="inline-block px-6 py-3 bg-white/10 backdrop-blur-md rounded-full border border-white/20">
      <span class="text-white/80 text-sm">
        <i class="fas fa-building mr-2"></i>
        Panel Empresarial ‚Ä¢ {{ dashboard_summary.empresa.nombre }}
      </span>
    </div>
  </div>

</div>
{% endblock %}

{% block page_js %}
<script id="dashboardSummaryData" type="application/json">
{{ dashboard_summary | tojson }}
</script>

<script>
// Cargar datos del dashboard
try {
  const summaryElement = document.getElementById('dashboardSummaryData');
  const summaryText = summaryElement.textContent;
  window.DASHBOARD_SUMMARY = summaryText && summaryText !== 'null' ? JSON.parse(summaryText) : null;
  console.log('üìä Dashboard summary loaded:', window.DASHBOARD_SUMMARY);
} catch (error) {
  console.warn('‚ö†Ô∏è Error loading dashboard summary:', error);
  window.DASHBOARD_SUMMARY = null;
}

// Funci√≥n para mostrar informaci√≥n del sistema
function showSystemInfo() {
  const systemInfo = `
    üè¢ Empresa: {{ empresa_username }}
    üÜî ID: {{ empresa_id }}
    üë§ Rol: {{ user_role }}
    üìä KPIs Cargados: ${window.DASHBOARD_SUMMARY ? 'S√≠' : 'No'}
    
    üìà Estad√≠sticas:
    - Usuarios Total: {{ dashboard_summary.kpis.usuarios_total }}
    - Usuarios Activos: {{ dashboard_summary.kpis.usuarios_activos }}
    - Hardware Total: {{ dashboard_summary.kpis.hardware_total }}
    - Alertas Activas: {{ dashboard_summary.kpis.alertas_activas }}
  `;
  
  alert(systemInfo);
}

// Animaciones suaves para las tarjetas
document.addEventListener('DOMContentLoaded', function() {
  const cards = document.querySelectorAll('.kpi-card, .quick-access-card');
  
  cards.forEach((card, index) => {
    setTimeout(() => {
      card.style.opacity = '1';
      card.style.transform = 'translateY(0)';
    }, index * 100);
  });
  
  console.log('üè¢ Dashboard principal de empresa inicializado');
  console.log('üë§ Usuario:', '{{ empresa_username }}');
  console.log('üÜî Empresa ID:', '{{ empresa_id }}');
  console.log('üìã Rol:', '{{ user_role }}');
});
</script>
{% endblock %}
