{% extends "empresa/dashboard.html" %}

{% block title %}Dashboard Principal - {{ empresa_username }}{% endblock %}

{% block extra_css %}
{{ super() }}
<!-- Usar los estilos iOS que ya sabemos -->
<link href="{{ url_for('static', filename='css/hardware/hardware-main.css') }}" rel="stylesheet">
<style>
/* Asegurar visibilidad por defecto */
.ios-stats-grid .ios-stat-card,
.dashboard-main-container .ios-stat-card,
.ios-hardware-grid .ios-hardware-card,
.dashboard-main-container .ios-hardware-card,
.quick-access-card {
  opacity: 1 !important;
  transform: none !important;
  visibility: visible !important;
}

/* Asegurar que las tarjetas iOS funcionen como enlaces */
.ios-hardware-card {
  cursor: pointer;
  text-decoration: none;
  color: inherit;
}

.ios-hardware-card:hover {
  text-decoration: none;
  color: inherit;
}

/* Estilos espec√≠ficos para dashboard empresarial - usando clases iOS */
/* Los estilos personalizados ahora est√°n definidos en ios-header.css e ios-cards.css */
</style>
{% endblock %}

{% block main_content %}
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 dashboard-main-container">
  
  <!-- Welcome Section -->
  <div class="ios-header-container mb-8">
    <div class="ios-header-backdrop">
      <div class="ios-header-content">
        <div class="ios-header-text">
          <div class="ios-header-icon">
            <span class="text-white font-bold text-2xl">{{ dashboard_summary.empresa.nombre[:2].upper() }}</span>
          </div>
          <div>
            <h1 class="ios-header-title">¬°Bienvenido!</h1>
            <p class="ios-header-subtitle">Panel de Control Empresarial ‚Ä¢ {{ dashboard_summary.empresa.nombre }}</p>
          </div>
        </div>
        <div class="ios-header-actions">
          <div class="ios-status-badge {% if dashboard_summary.empresa.activa %}ios-status-available{% else %}ios-status-stock{% endif %}">
            <i class="fas {% if dashboard_summary.empresa.activa %}fa-check-circle{% else %}fa-times-circle{% endif %}"></i>
            <span>{% if dashboard_summary.empresa.activa %}ACTIVA{% else %}INACTIVA{% endif %}</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- KPIs Principales -->
  <div class="mb-8">
    <h3 class="text-xl font-bold text-white mb-4">
      <i class="fas fa-tachometer-alt mr-2 text-blue-400"></i>
      KPIs Principales
    </h3>
    <div class="ios-stats-grid">
      
      <!-- Total Usuarios -->
      <div class="ios-stat-card gsap-animated">
        <div class="ios-stat-icon ios-stat-icon-blue">
          <i class="fas fa-users"></i>
        </div>
        <div class="ios-stat-content">
          <div class="ios-stat-label">Total Usuarios</div>
          <div class="ios-stat-value">{{ dashboard_summary.kpis.usuarios_total }}</div>
          <div class="ios-stat-trend">{{ dashboard_summary.kpis.usuarios_activos }} activos</div>
        </div>
        <div class="ios-stat-shimmer"></div>
      </div>

      <!-- Hardware Total -->
      <div class="ios-stat-card gsap-animated">
        <div class="ios-stat-icon ios-stat-icon-green">
          <i class="fas fa-microchip"></i>
        </div>
        <div class="ios-stat-content">
          <div class="ios-stat-label">Hardware Total</div>
          <div class="ios-stat-value">{{ dashboard_summary.kpis.hardware_total }}</div>
          <div class="ios-stat-trend">dispositivos</div>
        </div>
        <div class="ios-stat-shimmer"></div>
      </div>

      <!-- Alertas Activas -->
      <div class="ios-stat-card gsap-animated">
        <div class="ios-stat-icon ios-stat-icon-red">
          <i class="fas fa-exclamation-triangle"></i>
        </div>
        <div class="ios-stat-content">
          <div class="ios-stat-label">Alertas Activas</div>
          <div class="ios-stat-value">{{ dashboard_summary.kpis.alertas_activas }}</div>
          <div class="ios-stat-trend">pendientes</div>
        </div>
        <div class="ios-stat-shimmer"></div>
      </div>

      <!-- Estado General -->
      <div class="ios-stat-card gsap-animated">
        <div class="ios-stat-icon ios-stat-icon-purple">
          <i class="fas fa-check-circle"></i>
        </div>
        <div class="ios-stat-content">
          <div class="ios-stat-label">Estado General</div>
          <div class="ios-stat-value">OK</div>
          <div class="ios-stat-trend">sistema operativo</div>
        </div>
        <div class="ios-stat-shimmer"></div>
      </div>

    </div>
  </div>

  <!-- Acceso R√°pido -->
  <div class="mb-8">
    <h3 class="text-xl font-bold text-white mb-4">
      <i class="fas fa-rocket mr-2 text-purple-400"></i>
      Acceso R√°pido
    </h3>
    <div class="ios-hardware-grid">
      
      {% for item in dashboard_summary.quick_access %}
      <a href="{{ url_for(item.url) }}" class="ios-hardware-card gsap-animated">
        <div class="ios-card-header">
          <div class="ios-card-icon">
            <i class="{{ item.icon }}"></i>
          </div>
          <div class="ios-status-badge ios-status-available">
            <i class="fas fa-check"></i>
            <span>Disponible</span>
          </div>
        </div>
        <div class="ios-card-body">
          <h4 class="ios-card-title">{{ item.name }}</h4>
          <p class="ios-card-subtitle">{{ item.description }}</p>
        </div>
        <div class="ios-card-shimmer"></div>
      </a>
      {% endfor %}

      <!-- Estad√≠sticas del Sistema (adicional) -->
      <div class="ios-hardware-card gsap-animated" onclick="showSystemInfo()">
        <div class="ios-card-header">
          <div class="ios-card-icon" style="background: linear-gradient(135deg, #10b981, #047857);">
            <i class="fas fa-info-circle"></i>
          </div>
          <div class="ios-status-badge ios-status-available">
            <i class="fas fa-info"></i>
            <span>Sistema</span>
          </div>
        </div>
        <div class="ios-card-body">
          <h4 class="ios-card-title">Informaci√≥n del Sistema</h4>
          <p class="ios-card-subtitle">Ver detalles t√©cnicos y estado del sistema</p>
        </div>
        <div class="ios-card-shimmer"></div>
      </div>

    </div>
  </div>

  <!-- Informaci√≥n adicional -->
  <div class="text-center mt-8">
    <div class="inline-block px-6 py-3 bg-white/10 backdrop-blur-md rounded-full border border-white/20">
      <span class="text-white/80 text-sm">
        <i class="fas fa-building mr-2"></i>
        Panel Empresarial ‚Ä¢ {{ dashboard_summary.empresa.nombre }}
      </span>
    </div>
  </div>

</div>
{% endblock %}

{% block page_js %}
<script id="dashboardSummaryData" type="application/json">
{{ dashboard_summary | tojson }}
</script>

<script>
// Cargar datos del dashboard
try {
  const summaryElement = document.getElementById('dashboardSummaryData');
  const summaryText = summaryElement.textContent;
  window.DASHBOARD_SUMMARY = summaryText && summaryText !== 'null' ? JSON.parse(summaryText) : null;
  console.log('üìä Dashboard summary loaded:', window.DASHBOARD_SUMMARY);
} catch (error) {
  console.warn('‚ö†Ô∏è Error loading dashboard summary:', error);
  window.DASHBOARD_SUMMARY = null;
}

// Funci√≥n para mostrar informaci√≥n del sistema
function showSystemInfo() {
  const systemInfo = `
    üè¢ Empresa: {{ empresa_username }}
    üÜî ID: {{ empresa_id }}
    üë§ Rol: {{ user_role }}
    üìä KPIs Cargados: ${window.DASHBOARD_SUMMARY ? 'S√≠' : 'No'}
    
    üìà Estad√≠sticas:
    - Usuarios Total: {{ dashboard_summary.kpis.usuarios_total }}
    - Usuarios Activos: {{ dashboard_summary.kpis.usuarios_activos }}
    - Hardware Total: {{ dashboard_summary.kpis.hardware_total }}
    - Alertas Activas: {{ dashboard_summary.kpis.alertas_activas }}
  `;
  
  alert(systemInfo);
}

// Animaciones suaves para las tarjetas
document.addEventListener('DOMContentLoaded', function() {
  const cards = document.querySelectorAll('.kpi-card, .quick-access-card');
  
  cards.forEach((card, index) => {
    setTimeout(() => {
      card.style.opacity = '1';
      card.style.transform = 'translateY(0)';
    }, index * 100);
  });
  
  console.log('üè¢ Dashboard principal de empresa inicializado');
  console.log('üë§ Usuario:', '{{ empresa_username }}');
  console.log('üÜî Empresa ID:', '{{ empresa_id }}');
  console.log('üìã Rol:', '{{ user_role }}');
});
</script>
{% endblock %}
