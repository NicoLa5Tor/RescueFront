{% extends "empresa/dashboard.html" %}

{% block title %}Alertas Inactivas - Empresa{% endblock %}

{% block extra_css %}
{{ super() }}
<!-- Alertas espec√≠ficas styles -->
<link href="{{ url_for('static', filename='css/alerts/alerts-styles.css') }}" rel="stylesheet">
{% endblock %}

{% block main_content %}
<div class="p-4 sm:p-6 lg:p-8">
  <div class="ios-header-container mb-6">
    <div class="ios-header-backdrop">
      <div class="ios-header-content">
        <div class="ios-header-text">
          <div class="ios-header-icon">
            <i class="fas fa-exclamation-triangle"></i>
          </div>
          <div>
            <h1 class="ios-header-title text-xl sm:text-2xl lg:text-3xl">Alertas Inactivas üö´</h1>
            <p class="ios-header-subtitle text-sm sm:text-base">Historial de alertas desactivadas de tu empresa</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Grid de Alertas -->
  <div id="inactiveAlertsContainer" class="space-y-3 sm:space-y-4">
    <!-- Loading skeleton -->
    <div id="loadingSkeletonInactive" class="space-y-3 sm:space-y-4">
      <div class="skeleton-item h-24 sm:h-32 bg-gray-100 dark:bg-gray-700 rounded-lg"></div>
      <div class="skeleton-item h-24 sm:h-32 bg-gray-100 dark:bg-gray-700 rounded-lg"></div>
      <div class="skeleton-item h-24 sm:h-32 bg-gray-100 dark:bg-gray-700 rounded-lg"></div>
    </div>
    
    <!-- No alerts message -->
    <div id="noInactiveAlertsMessage" class="no-alerts-message hidden">
      <i class="fas fa-bell-slash text-4xl sm:text-6xl mb-4 opacity-50"></i>
      <p class="text-base sm:text-lg">No hay alertas inactivas</p>
      <p class="text-xs sm:text-sm mt-2">Las alertas aparecer√°n aqu√≠ una vez desactivadas</p>
    </div>
  </div>

  <!-- Paginaci√≥n -->
  <div class="flex flex-col sm:flex-row justify-center items-center gap-4 mt-6" id="paginationContainerInactive" style="display: none;">
    <button id="prevPageBtnInactive" class="pagination-btn text-sm" onclick="changePageInactive(-1)" disabled>
      <i class="fas fa-chevron-left"></i> <span class="hidden sm:inline">Anterior</span>
    </button>
    
    <div class="pagination-info text-center">
      <span id="pageInfoInactive" class="text-sm sm:text-base">P√°gina 1 de 1</span>
    </div>
    
    <button id="nextPageBtnInactive" class="pagination-btn text-sm" onclick="changePageInactive(1)" disabled>
      <span class="hidden sm:inline">Siguiente</span> <i class="fas fa-chevron-right"></i>
    </button>
  </div>
</div>

<!-- Modal para detalles de alerta - iOS STYLE LIKE HARDWARE -->
<div id="alertDetailModal" class="ios-modal-backdrop hidden">
  <div class="ios-blur-modal-container w-full max-w-6xl">
    <!-- Modal Header -->
    <div class="ios-blur-header">
      <div class="flex items-center justify-between w-full">
        <div class="flex items-center space-x-3">
          <div class="w-12 h-12 bg-gradient-to-br from-red-500 to-orange-600 rounded-xl flex items-center justify-center shadow-lg">
            <i class="fas fa-exclamation-triangle text-white text-xl"></i>
          </div>
          <div>
            <h3 class="text-2xl font-bold text-white">Detalles de la Alerta</h3>
            <p class="text-sm text-white/70" id="modalAlertSubtitle">Informaci√≥n completa de la alerta seleccionada</p>
          </div>
        </div>
        <button type="button" class="ios-blur-btn ios-blur-btn-secondary !p-2 !min-w-0" onclick="closeAlertModal()" aria-label="Cerrar modal">
          <i class="fas fa-times text-lg"></i>
        </button>
      </div>
    </div>
    
    <!-- Modal Body -->
    <div class="ios-blur-body">
      <div id="alertDetailsContent" class="space-y-6">
        <!-- Content will be populated by JavaScript -->
      </div>
    </div>
    
    <!-- Modal Footer -->
    <div class="ios-blur-footer">
      <button type="button" class="ios-blur-btn ios-blur-btn-secondary" onclick="closeAlertModal()">
        <i class="fas fa-times mr-2"></i>
        Cerrar
      </button>
      <button type="button" class="ios-blur-btn ios-blur-btn-primary" onclick="showDeactivateConfirmation()" id="toggleStatusBtn">
        <i class="fas fa-toggle-on mr-2"></i>
        <span id="toggleStatusText">Activar</span>
      </button>
    </div>
  </div>
</div>
{% endblock %}

{% block page_js %}
<!-- Dependencias requeridas -->
<script src="{{ url_for('static', filename='js/modal-utils.js') }}"></script>
<script src="{{ url_for('static', filename='js/api-client.js') }}"></script>


<!-- Archivo principal de alertas inactivas modularizado -->
<script src="{{ url_for('static', filename='js/alerts/alerts-inactive-main.js') }}"></script>

<!-- Script de debug temporal para testing -->
<script src="{{ url_for('static', filename='js/debug/test-inactive-alerts.js') }}"></script>

<script>
// Inicializar cliente API (requerido por alerts-inactive-main.js)
if (typeof EndpointTestClient !== 'undefined') {
    window.apiClient = new EndpointTestClient();
    //console.log('‚úÖ API Client inicializado correctamente para alertas inactivas');
} else {
    //console.warn('‚ö†Ô∏è EndpointTestClient no est√° disponible');
}

// Auto-verificar el estado del sistema despu√©s de la carga
window.addEventListener('load', () => {
    setTimeout(() => {
        if (window.testingTools) {
            //console.log('üîç AUTO-CHECK: Verificando estado del sistema de alertas inactivas...');
            window.testingTools.quickCheck();
        }
    }, 2000);
});
</script>
{% endblock %}
