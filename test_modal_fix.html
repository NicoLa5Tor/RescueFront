<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Modal Fix - Usuarios y Tipos de Empresa</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- CSS de modales -->
    <link href="static/css/modals.css" rel="stylesheet">
    <link href="static/css/usuarios/usuarios-modal-fix.css" rel="stylesheet">
    <link href="static/css/company-types/company-types-modal-fix.css" rel="stylesheet">
    <link href="static/css/company-types/ios-modals.css" rel="stylesheet">
    
    <style>
        .test-container {
            min-height: 200vh; /* Para probar scroll */
            background: linear-gradient(45deg, #f0f9ff, #e0f2fe);
            padding: 2rem;
        }
        
        .test-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .test-modal.hidden {
            display: none;
        }
        
        .test-modal-content {
            background: white;
            border-radius: 1rem;
            padding: 2rem;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
            position: relative;
        }
        
        .test-results {
            background: white;
            border-radius: 1rem;
            padding: 2rem;
            margin: 2rem 0;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        }
        
        .test-item {
            padding: 1rem;
            margin: 0.5rem 0;
            border-radius: 0.5rem;
            border-left: 4px solid;
        }
        
        .test-pass {
            background: rgba(16, 185, 129, 0.1);
            border-color: #10b981;
            color: #065f46;
        }
        
        .test-fail {
            background: rgba(239, 68, 68, 0.1);
            border-color: #ef4444;
            color: #991b1b;
        }
        
        .test-warning {
            background: rgba(245, 158, 11, 0.1);
            border-color: #f59e0b;
            color: #92400e;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1 class="text-4xl font-bold text-center mb-8">Test de Fix de Modales</h1>
        
        <div class="max-w-4xl mx-auto">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                <!-- Botones de prueba para modales de usuarios -->
                <div class="bg-white p-6 rounded-lg shadow-lg">
                    <h2 class="text-2xl font-bold mb-4 text-blue-600">
                        <i class="fas fa-users mr-2"></i>Modales de Usuarios
                    </h2>
                    <div class="space-y-3">
                        <button onclick="testUserModal()" class="w-full bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                            <i class="fas fa-user-plus mr-2"></i>Test Modal Crear Usuario
                        </button>
                        <button onclick="testEditUserModal()" class="w-full bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors">
                            <i class="fas fa-user-edit mr-2"></i>Test Modal Editar Usuario
                        </button>
                    </div>
                </div>
                
                <!-- Botones de prueba para modales de tipos de empresa -->
                <div class="bg-white p-6 rounded-lg shadow-lg">
                    <h2 class="text-2xl font-bold mb-4 text-purple-600">
                        <i class="fas fa-building mr-2"></i>Modales de Tipos de Empresa
                    </h2>
                    <div class="space-y-3">
                        <button onclick="testCompanyTypeModal()" class="w-full bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors">
                            <i class="fas fa-plus mr-2"></i>Test Modal Crear Tipo
                        </button>
                        <button onclick="testToggleModal()" class="w-full bg-orange-600 text-white px-4 py-2 rounded-lg hover:bg-orange-700 transition-colors">
                            <i class="fas fa-toggle-on mr-2"></i>Test Modal Toggle
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Botón para ejecutar pruebas automáticas -->
            <div class="text-center mb-8">
                <button onclick="runAutomaticTests()" class="bg-gray-800 text-white px-8 py-3 rounded-lg text-lg font-semibold hover:bg-gray-900 transition-colors">
                    <i class="fas fa-play mr-2"></i>Ejecutar Pruebas Automáticas
                </button>
            </div>
            
            <!-- Resultados de las pruebas -->
            <div class="test-results" id="testResults" style="display: none;">
                <h3 class="text-2xl font-bold mb-4">
                    <i class="fas fa-clipboard-check mr-2"></i>Resultados de las Pruebas
                </h3>
                <div id="testOutput"></div>
            </div>
        </div>
    </div>
    
    <!-- Modal de prueba para usuarios (max-w-3xl) -->
    <div id="testUserModal" class="test-modal hidden">
        <div class="test-modal-content max-w-3xl w-full mx-4">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-2xl font-bold text-blue-600">
                    <i class="fas fa-user-plus mr-2"></i>Test Modal Usuario
                </h2>
                <button onclick="closeTestModal('testUserModal')" class="text-gray-400 hover:text-gray-600 text-2xl">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="bg-blue-50 p-4 rounded-lg mb-4">
                <p><strong>Tamaño esperado:</strong> max-w-3xl (más pequeño que antes)</p>
                <p><strong>Clase CSS aplicada:</strong> usuarios-modal-open</p>
                <p><strong>Sin interferencias de:</strong> company-types modales</p>
            </div>
            <div class="grid grid-cols-2 gap-4 text-sm">
                <div><strong>Nombre:</strong> <input type="text" class="border rounded px-2 py-1 w-full" placeholder="Juan Pérez"></div>
                <div><strong>Email:</strong> <input type="email" class="border rounded px-2 py-1 w-full" placeholder="juan@email.com"></div>
                <div><strong>Teléfono:</strong> <input type="tel" class="border rounded px-2 py-1 w-full" placeholder="+1234567890"></div>
                <div><strong>Rol:</strong> 
                    <select class="border rounded px-2 py-1 w-full">
                        <option>Admin</option>
                        <option>Usuario</option>
                    </select>
                </div>
            </div>
            <div class="flex justify-end gap-3 mt-6">
                <button onclick="closeTestModal('testUserModal')" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-lg">Cancelar</button>
                <button class="px-4 py-2 bg-blue-600 text-white rounded-lg">Guardar</button>
            </div>
        </div>
    </div>
    
    <!-- Modal de prueba para tipos de empresa (max-w-2xl) -->
    <div id="testCompanyTypeModal" class="test-modal hidden">
        <div class="test-modal-content max-w-2xl w-full mx-4">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-2xl font-bold text-purple-600">
                    <i class="fas fa-building mr-2"></i>Test Modal Tipo de Empresa
                </h2>
                <button onclick="closeTestModal('testCompanyTypeModal')" class="text-gray-400 hover:text-gray-600 text-2xl">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="bg-purple-50 p-4 rounded-lg mb-4">
                <p><strong>Tamaño esperado:</strong> max-w-2xl</p>
                <p><strong>Clase CSS aplicada:</strong> company-types-modal-open</p>
                <p><strong>Sin interferencias con:</strong> usuarios modales</p>
            </div>
            <div class="space-y-4">
                <div><strong>Nombre:</strong> <input type="text" class="border rounded px-2 py-1 w-full" placeholder="Tecnología"></div>
                <div><strong>Descripción:</strong> <textarea class="border rounded px-2 py-1 w-full h-24" placeholder="Empresas del sector tecnológico"></textarea></div>
            </div>
            <div class="flex justify-end gap-3 mt-6">
                <button onclick="closeTestModal('testCompanyTypeModal')" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-lg">Cancelar</button>
                <button class="px-4 py-2 bg-purple-600 text-white rounded-lg">Guardar</button>
            </div>
        </div>
    </div>

    <script>
        // Funciones para abrir/cerrar modales de prueba
        function testUserModal() {
            document.getElementById('testUserModal').classList.remove('hidden');
            document.body.classList.add('usuarios-modal-open');
        }
        
        function testEditUserModal() {
            testUserModal(); // Reusar el mismo modal para simplificar
        }
        
        function testCompanyTypeModal() {
            document.getElementById('testCompanyTypeModal').classList.remove('hidden');
            document.body.classList.add('company-types-modal-open');
        }
        
        function testToggleModal() {
            testCompanyTypeModal(); // Reusar el mismo modal para simplificar
        }
        
        function closeTestModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
            document.body.classList.remove('usuarios-modal-open', 'company-types-modal-open');
        }
        
        // Pruebas automáticas
        function runAutomaticTests() {
            const results = document.getElementById('testResults');
            const output = document.getElementById('testOutput');
            
            results.style.display = 'block';
            output.innerHTML = '<div class="text-center text-gray-600">Ejecutando pruebas...</div>';
            
            setTimeout(() => {
                const tests = [
                    testCSSFiles(),
                    testModalClasses(),
                    testModalSizes(),
                    testNoInterferences()
                ];
                
                let html = '';
                let passCount = 0;
                
                tests.forEach((test, index) => {
                    html += `<div class="test-item ${test.status === 'pass' ? 'test-pass' : test.status === 'fail' ? 'test-fail' : 'test-warning'}">
                        <div class="flex items-center justify-between">
                            <strong>${test.name}</strong>
                            <span class="text-sm">
                                <i class="fas fa-${test.status === 'pass' ? 'check' : test.status === 'fail' ? 'times' : 'exclamation-triangle'} mr-1"></i>
                                ${test.status.toUpperCase()}
                            </span>
                        </div>
                        <div class="mt-1 text-sm">${test.message}</div>
                    </div>`;
                    
                    if (test.status === 'pass') passCount++;
                });
                
                html = `<div class="mb-4 text-center">
                    <span class="text-2xl font-bold ${passCount === tests.length ? 'text-green-600' : passCount > tests.length / 2 ? 'text-orange-600' : 'text-red-600'}">
                        ${passCount}/${tests.length} pruebas pasaron
                    </span>
                </div>` + html;
                
                output.innerHTML = html;
            }, 1000);
        }
        
        function testCSSFiles() {
            // Verificar que los archivos CSS estén presentes
            const cssLinks = Array.from(document.querySelectorAll('link[rel="stylesheet"]'));
            const hasUserCSS = cssLinks.some(link => link.href.includes('usuarios-modal-fix.css'));
            const hasCompanyTypeCSS = cssLinks.some(link => link.href.includes('company-types-modal-fix.css'));
            
            if (hasUserCSS && hasCompanyTypeCSS) {
                return {
                    name: 'Archivos CSS',
                    status: 'pass',
                    message: 'Todos los archivos CSS de modales están cargados correctamente.'
                };
            } else {
                return {
                    name: 'Archivos CSS',
                    status: 'fail',
                    message: `Faltan archivos CSS: ${!hasUserCSS ? 'usuarios-modal-fix.css' : ''} ${!hasCompanyTypeCSS ? 'company-types-modal-fix.css' : ''}`
                };
            }
        }
        
        function testModalClasses() {
            // Verificar que las clases específicas existen en CSS
            const styles = Array.from(document.styleSheets);
            let hasUserClass = false;
            let hasCompanyTypeClass = false;
            
            try {
                styles.forEach(sheet => {
                    try {
                        const rules = sheet.cssRules || sheet.rules;
                        Array.from(rules).forEach(rule => {
                            if (rule.selectorText) {
                                if (rule.selectorText.includes('usuarios-modal-open')) hasUserClass = true;
                                if (rule.selectorText.includes('company-types-modal-open')) hasCompanyTypeClass = true;
                            }
                        });
                    } catch (e) {
                        // Ignorar errores de CORS para estilos externos
                    }
                });
            } catch (e) {
                return {
                    name: 'Clases CSS específicas',
                    status: 'warning',
                    message: 'No se pudieron verificar las clases CSS debido a restricciones del navegador, pero los archivos están cargados.'
                };
            }
            
            if (hasUserClass && hasCompanyTypeClass) {
                return {
                    name: 'Clases CSS específicas',
                    status: 'pass',
                    message: 'Las clases específicas usuarios-modal-open y company-types-modal-open están definidas.'
                };
            } else {
                return {
                    name: 'Clases CSS específicas',
                    status: 'warning',
                    message: 'Verificación manual requerida - los archivos están cargados pero no se pueden inspeccionar automáticamente.'
                };
            }
        }
        
        function testModalSizes() {
            // Verificar que los modales tienen el tamaño correcto
            const userModal = document.querySelector('#testUserModal .test-modal-content');
            const companyTypeModal = document.querySelector('#testCompanyTypeModal .test-modal-content');
            
            const userHasMaxW3xl = userModal.classList.contains('max-w-3xl');
            const companyTypeHasMaxW2xl = companyTypeModal.classList.contains('max-w-2xl');
            
            if (userHasMaxW3xl && companyTypeHasMaxW2xl) {
                return {
                    name: 'Tamaños de modales',
                    status: 'pass',
                    message: 'Los modales de usuarios (max-w-3xl) y tipos de empresa (max-w-2xl) tienen los tamaños correctos.'
                };
            } else {
                return {
                    name: 'Tamaños de modales',
                    status: 'fail',
                    message: `Tamaños incorrectos: Usuario ${userHasMaxW3xl ? '✓' : '✗'} max-w-3xl, Tipo empresa ${companyTypeHasMaxW2xl ? '✓' : '✗'} max-w-2xl`
                };
            }
        }
        
        function testNoInterferences() {
            // Simular apertura de ambos modales para verificar que no interfieren
            document.body.classList.add('usuarios-modal-open');
            const hasUserClass = document.body.classList.contains('usuarios-modal-open');
            
            document.body.classList.remove('usuarios-modal-open');
            document.body.classList.add('company-types-modal-open');
            const hasCompanyTypeClass = document.body.classList.contains('company-types-modal-open');
            
            // Limpiar
            document.body.classList.remove('company-types-modal-open');
            
            if (hasUserClass && hasCompanyTypeClass) {
                return {
                    name: 'Aislamiento de clases',
                    status: 'pass',
                    message: 'Las clases específicas se aplican correctamente sin interferencias mutuas.'
                };
            } else {
                return {
                    name: 'Aislamiento de clases',
                    status: 'fail',
                    message: 'Las clases específicas no se aplican correctamente en el DOM.'
                };
            }
        }
        
        // Auto-scroll smooth al hacer scroll
        document.addEventListener('DOMContentLoaded', function() {
            document.documentElement.style.scrollBehavior = 'smooth';
        });
    </script>
</body>
</html>
